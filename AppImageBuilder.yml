version: 1

# Build PrusaSlicer before packaging
script: |
  [[ -d "./PrusaSlicer" ]] || git clone https://github.com/prusa3d/PrusaSlicer --single-branch --branch version_2.4.0-beta1 --depth 1 PrusaSlicer 
  cd PrusaSlicer/deps && \
  mkdir -p build && \
  cd build && \
  CPWD=$(readlink -f .) && \
  cmake .. -DDEP_WX_GTK3=ON && \
  make -j$(nproc) && \
  cd ../.. && \
  mkdir -p build && \
  cd build && \
  cmake .. \
  -DCMAKE_INSTALL_PREFIX=/usr \
  -DCMAKE_PREFIX_PATH=$(pwd)/../deps/build/destdir/usr/local \
  -DSLIC3R_PCH=OFF \
  -DSLIC3R_STATIC=1 \
  -DSLIC3R_WX_STABLE=0 \
  -DSLIC3R_GTK=3 && \
  DESTDIR=AppDir make -j$(nproc) install && \
  mkdir -p AppDir/usr/share/mime && \
  update-mime-database AppDir/usr/share/mime

AppDir:
  path: ./PrusaSlicer/build/AppDir

  app_info:
    id: com.prusa3d.PrusaSlicer
    name: PrusaSlicer
    # TODO(davidk): Replace with PrusaSlicer's icon
    icon: utilities-terminal
    version: version_2.4.0-beta1
    exec: usr/bin/prusa-slicer
  runtime:
    env:
      APPDIR_LIBRARY_PATH: '$APPDIR/usr/lib/aarch64-linux-gnu:$APPDIR/lib/aarch64-linux-gnu:$APPDIR/usr/lib:$APPDIR/usr/lib/gcc/aarch64-linux-gnu:$APPDIR/usr/lib/aarch64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders'
      XDG_DATA_DIRS: $APPDIR/share:$XDG_DATA_DIRS
  apt:
    arch: arm64
    allow_unauthenticated: true
    sources:
      - sourceline: 'deb [arch=arm64] http://ports.ubuntu.com/ubuntu-ports/ groovy main restricted'
      - sourceline: 'deb [arch=arm64] http://ports.ubuntu.com/ubuntu-ports/ groovy-updates main restricted'
      - sourceline: 'deb [arch=arm64] http://ports.ubuntu.com/ubuntu-ports/ groovy main restricted'
      - sourceline: 'deb [arch=arm64] http://ports.ubuntu.com/ubuntu-ports/ groovy-updates main restricted'
      - sourceline: 'deb [arch=arm64] http://ports.ubuntu.com/ubuntu-ports/ groovy universe'
      - sourceline: 'deb [arch=arm64] http://ports.ubuntu.com/ubuntu-ports/ groovy-updates universe'
      - sourceline: 'deb [arch=arm64] http://ports.ubuntu.com/ubuntu-ports/ groovy multiverse'
      - sourceline: 'deb [arch=arm64] http://ports.ubuntu.com/ubuntu-ports/ groovy-updates multiverse'
      - sourceline: 'deb [arch=arm64] http://ports.ubuntu.com/ubuntu-ports/ groovy-backports main restricted universe multiverse'
      - sourceline: 'deb [arch=arm64] http://ports.ubuntu.com/ubuntu-ports/ groovy-security main restricted'
      - sourceline: 'deb [arch=arm64] http://ports.ubuntu.com/ubuntu-ports/ groovy-security universe'
      - sourceline: 'deb [arch=arm64] http://ports.ubuntu.com/ubuntu-ports/ groovy-security multiverse'

    include:
      - python3
      - bash
      - gcc-10
      - libgail-common
      - libatk-bridge2.0-0
      - libcanberra-gtk3-module
      - libgl1-mesa-dri
      - libcgal-dev
      - libboost-dev 
      - libboost-regex-dev 
      - libboost-filesystem-dev
      - libboost-thread-dev
      - libboost-log-dev
      - libboost-locale-dev 
      - libcurl4-openssl-dev
      - libtbb-dev 
      - zlib1g-dev
      - libcereal-dev 
      - libeigen3-dev 
      - libnlopt-cxx-dev 
      - libudev-dev 
      - libopenvdb-dev 
      - libboost-iostreams-dev 
      - libgmpxx4ldbl 
      - libnlopt-dev 
      - libdbus-1-dev 
      - libgtk2.0-dev 
      - libgtk-3-dev 
      - libstdc++6
      - libgmpxx4ldbl
      - libnlopt-dev
      - libdbus-1-dev 
      - libgtk2.0-dev 
      - libgtk-3-dev
      - libwxgtk3.0-gtk3-dev 
      - adwaita-icon-theme
      - librsvg2-common
      - shared-mime-info
AppImage: 
  update-information: None
  sign-key: None
  arch: aarch64
